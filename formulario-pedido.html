<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flora - Cat√°logo de Arreglos</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    :root {
      --rosa:#e6a5b6; 
      --rosa-osc:#c97b94;
      --bg:#fdfaf7; 
      --gris:#5c5c5c; 
      --borde:#ecd6dc;
    }
    *{box-sizing:border-box;}
    body {
      font-family:'Inter',sans-serif;
      background:var(--bg);
      margin:0;
      color:#333;
      transition: all .3s ease;
    }
    header{text-align:center;padding:24px 10px;}
    header img{max-width:220px;display:block;margin:0 auto 8px;}
    header h2{color:var(--rosa-osc);font-size:1.5rem;}

    .view{display:none;padding:16px;}
    .view.active{display:block;animation:fadeIn .4s ease;}
    @keyframes fadeIn{from{opacity:0;}to{opacity:1;}}

    /* === CAT√ÅLOGO === */
    .catalogo {
      display:grid;
      gap:16px;
      grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      max-width:1100px;
      margin:0 auto;
    }
    .card {
      background:#fff;
      border:1px solid var(--borde);
      border-radius:18px;
      box-shadow:0 6px 18px rgba(0,0,0,.06);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      transition:transform .15s ease, box-shadow .15s ease;
    }
    .card:hover {transform:translateY(-3px);box-shadow:0 10px 24px rgba(0,0,0,.1);}
    .card img {width:100%;height:260px;object-fit:cover;background:#fff8f9;}
    .card .body {flex:1;text-align:center;padding:12px 10px 16px;}
    .name {font-weight:700;font-size:.95rem;}
    .price {color:var(--gris);font-size:.9rem;margin:6px 0 12px;}
    .btn-add {
      width:100%;padding:10px;border:none;border-radius:10px;
      background:var(--rosa);color:#fff;font-weight:700;cursor:pointer;
      transition:background .2s ease;
    }
    .btn-add:hover{background:var(--rosa-osc);}

    /* === CARRITO === */
    .cart-container {
      max-width:800px;margin:20px auto;background:#fff;
      padding:24px;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,0.08);
    }
    .cart-container h2{text-align:center;color:var(--rosa-osc);}
    .cart-item{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid #eee;}
    .cart-item:last-child{border-bottom:none;}
    .cart-item button{
      background:#ffe5eb;border:none;color:#c42e4a;border-radius:6px;
      padding:4px 8px;cursor:pointer;font-size:1.1rem;transition:all .2s;
    }
    .cart-item button:hover{background:#f7c1cf;}
    .qty-control{display:flex;align-items:center;gap:6px;}
    .qty-btn{background:var(--rosa);color:#fff;border:none;border-radius:5px;width:22px;height:22px;cursor:pointer;}
    .cart-summary p{margin:8px 0;text-align:right;}
    .cart-actions{display:flex;justify-content:space-between;margin-top:20px;gap:10px;}

    /* === FORMULARIO === */
    form {
      background:#fff;border:1px solid var(--borde);
      border-radius:20px;max-width:800px;margin:20px auto;
      padding:28px;box-shadow:0 8px 24px rgba(0,0,0,.08);
    }
    h3 {border-bottom:2px solid var(--rosa);padding-bottom:6px;margin:20px 0 16px;color:var(--rosa-osc);}
    label{font-weight:600;color:#444;}
    input,select,textarea {
      width:100%;padding:10px 14px;border:1px solid #d9d9d9;
      border-radius:10px;font-size:.95rem;background:#fff;
      transition:border-color .25s ease, box-shadow .25s ease;
    }
    input:focus,select:focus,textarea:focus {
      border-color:var(--rosa);
      box-shadow:0 0 0 3px rgba(230,165,182,0.2);
      outline:none;
    }
    textarea{min-height:90px;resize:vertical;}
    .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));}
    .pedido-summary{background:#fff3f6;border:1px solid var(--borde);border-radius:12px;padding:10px 16px;margin-bottom:16px;font-weight:600;color:#a34b6d;}
    .actions{display:flex;justify-content:space-between;margin-top:20px;gap:12px;}
    .btn-primary{background:var(--rosa);color:#fff;border:none;border-radius:10px;padding:12px 22px;font-weight:800;cursor:pointer;}
    .btn-outline{background:#fff;border:2px solid var(--rosa);color:var(--rosa);border-radius:10px;padding:12px 22px;font-weight:700;cursor:pointer;}
    .btn-outline:hover{background:var(--rosa);color:#fff;}
    .badge{display:inline-block;font-size:0.85rem;border-radius:999px;padding:4px 10px;margin-left:8px;vertical-align:middle;}
    .badge.ok{background:#e7f8ec;color:#137333;border:1px solid #b7e3c2;}
    .badge.warn{background:#fff7e6;color:#a15d00;border:1px solid #ffd59e;}

    /* === BOT√ìN FLOTANTE === */
    #btnVerCarrito {
      position:fixed;bottom:20px;right:20px;background:var(--rosa);
      color:#fff;border:none;border-radius:50%;width:56px;height:56px;
      cursor:pointer;font-size:1.4rem;box-shadow:0 6px 14px rgba(0,0,0,0.15);
    }
  </style>
</head>

<body>
  <header>
    <img src="img/logo 2024 marca registrada-04.png" alt="Flora Logo">
    <h2>Cat√°logo de Arreglos Florales</h2>
  </header>

  <!-- === CAT√ÅLOGO === -->
  <section id="viewCatalog" class="view active">
    <div id="catalogo" class="catalogo"></div>
  </section>

  <!-- === CARRITO === -->
  <section id="viewCart" class="view">
    <div class="cart-container">
      <h2>üõçÔ∏è Carrito de Compras</h2>
      <div id="cartItems"></div>
      <div class="cart-summary">
        <p><strong>Subtotal:</strong> $<span id="subtotal">0</span></p>
        <p><strong>Domicilio:</strong> $<span id="domicilio">0</span></p>
        <p><strong>Total:</strong> $<span id="total">0</span></p>
      </div>
      <div class="cart-actions">
        <button id="btnSeguirComprando" class="btn-outline">Seguir comprando</button>
        <button id="btnProcederPedido" class="btn-primary">Proceder al pedido</button>
      </div>
    </div>
  </section>

  <!-- === FORMULARIO === -->
  <section id="viewForm" class="view">
    <form id="pedidoForm">
      <div class="pedido-summary" id="resumenProducto">üõç Tu pedido</div>

      <h3>Datos del Cliente <span id="badgeCliente" class="badge warn">Nuevo cliente</span></h3>
      <div class="grid">
        <div><label>Identificaci√≥n</label><input id="identificacion" name="identificacion" required></div>
        <div><label>Tel√©fono</label><input id="telefono" name="telefono" required></div>
        <div><label>Nombre</label><input id="primerNombre" name="primerNombre" required></div>
      </div>

      <h3>Entrega</h3>
      <div class="grid">
        <div><label>Destinatario</label><input id="destinatario" name="destinatario" required></div>
        <div><label>Barrio</label><select id="barrio" name="barrio" required></select></div>
        <div><label>Direcci√≥n</label><input id="direccion" name="direccion" required></div>
      </div>

      <h3>Pago y Mensaje</h3>
      <div class="grid">
        <div><label>Medio de pago</label>
          <select id="formaPago" name="formaPago" required>
            <option value="">Selecciona una opci√≥n...</option>
            <option value="TRANSFERENCIA">Transferencia</option>
            <option value="EFECTIVO">Efectivo</option>
            <option value="CONTRAENTREGA">Contra entrega</option>
          </select>
        </div>
        <div><label>Mensaje</label><textarea id="mensaje" name="mensaje"></textarea></div>
      </div>

      <div class="actions">
        <button type="button" class="btn-outline" id="btnVolver">Regresar</button>
        <button type="submit" class="btn-primary">Confirmar pedido</button>
      </div>

      <input type="hidden" id="producto" name="producto">
      <input type="hidden" id="precio" name="precio">
    </form>
  </section>

  <button id="btnVerCarrito">üõí</button>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwol802NzgXkLtWVJiDLX_MnOXlyyWxL0AnVVef1GO8L7TVYAI5uH_6jkJomakcWlih/exec";
    const state = { catalogo: [], barrios: {}, cart: [], domicilio: 0 };
    const fmtCOP = v => Number(v || 0).toLocaleString('es-CO');

    async function init() {
      try {
        const res = await fetch(SCRIPT_URL);
        const data = await res.json();
        state.catalogo = data.catalogo || [];
        state.barrios = data.barrios || {};
        renderCatalog();
        fillBarrios();
      } catch (err) {
        console.error(err);
        Swal.fire("Error", "No se pudo cargar el cat√°logo", "error");
      }
    }

    function renderCatalog() {
      const cont = document.getElementById("catalogo");
      cont.innerHTML = "";
      state.catalogo.forEach(prod => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <img src="${prod.img}" alt="${prod.name}">
          <div class="body">
            <div class="name">${prod.name}</div>
            <div class="price">$${fmtCOP(prod.price)}</div>
            <button class="btn-add">Agregar al carrito</button>
          </div>`;
        card.querySelector(".btn-add").addEventListener("click", () => addToCart(prod));
        cont.appendChild(card);
      });
    }

    function fillBarrios() {
      const sel = document.getElementById("barrio");
      sel.innerHTML = '<option value="">Selecciona‚Ä¶</option>';
      Object.entries(state.barrios).forEach(([barrio, valor]) => {
        const opt = document.createElement("option");
        opt.value = barrio;
        opt.textContent = `${barrio} ($${fmtCOP(valor)})`;
        sel.appendChild(opt);
      });
      sel.addEventListener("change", () => {
        state.domicilio = state.barrios[sel.value] || 0;
        renderCart();
      });
    }

    function addToCart(prod) {
      const item = state.cart.find(p => p.name === prod.name);
      if (item) item.qty++;
      else state.cart.push({ ...prod, qty: 1 });
      Swal.fire({ title: "Agregado", text: `${prod.name} a√±adido`, icon: "success", timer: 1000, showConfirmButton: false });
    }

    function changeQty(name, delta) {
      const item = state.cart.find(p => p.name === name);
      if (!item) return;
      item.qty += delta;
      if (item.qty <= 0) state.cart = state.cart.filter(p => p.name !== name);
      renderCart();
    }

    function renderCart() {
      const cont = document.getElementById("cartItems");
      cont.innerHTML = "";
      if (state.cart.length === 0) {
        cont.innerHTML = "<p style='text-align:center;color:#666;'>Tu carrito est√° vac√≠o üõí</p>";
      } else {
        state.cart.forEach(p => {
          cont.innerHTML += `
            <div class="cart-item">
              <span>${p.name}</span>
              <div class="qty-control">
                <button class="qty-btn" onclick="changeQty('${p.name}',-1)">-</button>
                <span>${p.qty}</span>
                <button class="qty-btn" onclick="changeQty('${p.name}',1)">+</button>
              </div>
              <span>$${fmtCOP(p.price * p.qty)}</span>
              <button onclick="changeQty('${p.name}',-999)">üóëÔ∏è</button>
            </div>`;
        });
      }
      const subtotal = state.cart.reduce((a, b) => a + b.price * b.qty, 0);
      const total = subtotal + (state.domicilio || 0);
      document.getElementById("subtotal").textContent = fmtCOP(subtotal);
      document.getElementById("domicilio").textContent = fmtCOP(state.domicilio);
      document.getElementById("total").textContent = fmtCOP(total);
    }

    // === Navegaci√≥n ===
    const show = id => {
      document.querySelectorAll(".view").forEach(v => v.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    };

    document.getElementById("btnVerCarrito").onclick = () => { renderCart(); show("viewCart"); };
    document.getElementById("btnSeguirComprando").onclick = () => show("viewCatalog");
    document.getElementById("btnVolver").onclick = () => show("viewCart");

    document.getElementById("btnProcederPedido").onclick = () => {
      if (state.cart.length === 0) {
        Swal.fire("Carrito vac√≠o", "Agrega al menos un producto", "warning");
        return;
      }
      const resumen = state.cart.map(p => `${p.qty}x ${p.name}`).join(" | ");
      const subtotal = state.cart.reduce((a, b) => a + b.price * b.qty, 0);
      const total = subtotal + (state.domicilio || 0);
      document.getElementById("producto").value = resumen;
      document.getElementById("precio").value = total;
      document.getElementById("resumenProducto").textContent = `üõç ${resumen} ‚Äî Subtotal: $${fmtCOP(subtotal)} + Domicilio: $${fmtCOP(state.domicilio)} = Total: $${fmtCOP(total)}`;
      show("viewForm");
    };

    // === Enviar formulario ===
    document.getElementById("pedidoForm").addEventListener("submit", async e => {
      e.preventDefault();
      try {
        await fetch(SCRIPT_URL, { method: "POST", body: new FormData(e.target) });
        Swal.fire("Pedido enviado", "Tu pedido fue registrado correctamente üå∏", "success");
        state.cart = [];
        show("viewCatalog");
      } catch {
        Swal.fire("Error", "No se pudo enviar el pedido", "error");
      }
    });

    init();
  </script>
</body>
</html>
