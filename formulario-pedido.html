<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flora - Cat√°logo de Arreglos</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    :root {
      --rosa:#e6a5b6; 
      --rosa-osc:#c97b94;
      --bg:#fdfaf7; 
      --gris:#5c5c5c; 
      --borde:#ecd6dc;
    }
    *{box-sizing:border-box;}
    body {
      font-family:'Inter',sans-serif;
      background:var(--bg);
      margin:0;
      color:#333;
    }
    header{text-align:center;padding:24px 10px;}
    header img{max-width:220px;display:block;margin:0 auto 8px;}
    header h2{color:var(--rosa-osc);font-size:1.5rem;}

    .view{display:none;padding:16px;}
    .view.active{display:block;}

    /* === CAT√ÅLOGO === */
    .catalogo {
      display:grid;
      gap:16px;
      grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      max-width:1100px;
      margin:0 auto;
    }
    .card {
      background:#fff;
      border:1px solid var(--borde);
      border-radius:18px;
      box-shadow:0 6px 18px rgba(0,0,0,.06);
      overflow:hidden;
      cursor:pointer;
      display:flex;
      flex-direction:column;
      transition:transform .15s ease, box-shadow .15s ease;
    }
    .card:hover {
      transform:translateY(-2px);
      box-shadow:0 10px 24px rgba(0,0,0,.09);
    }
    .card img {
      width:100%;
      height:260px;
      object-fit:cover;
      object-position:center;
      background:#fff8f9;
    }
    .card .body {
      flex:1;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      text-align:center;
      padding:12px 10px 16px;
    }
    .name {font-weight:700;font-size:.95rem;min-height:40px;}
    .price {color:var(--gris);font-size:.9rem;margin:6px 0 12px;}
    .btn-add {
      width:100%;
      padding:10px;
      border:none;
      border-radius:10px;
      background:var(--rosa);
      color:#fff;
      font-weight:700;
      cursor:pointer;
      transition:background .2s ease;
    }
    .btn-add:hover{background:var(--rosa-osc);}

    /* === FORMULARIO === */
    form {
      background:#fff;border:1px solid var(--borde);
      border-radius:20px;max-width:800px;margin:20px auto;
      padding:28px;box-shadow:0 8px 24px rgba(0,0,0,.08);
    }
    h3 {
      border-bottom:2px solid var(--rosa);
      padding-bottom:6px;margin:20px 0 16px;
      color:var(--rosa-osc);
    }
    label{font-weight:600;color:#444;}
    input,select,textarea {
      width:100%;padding:10px 14px;border:1px solid #d9d9d9;
      border-radius:10px;font-size:.95rem;background:#fff;
      transition:border-color .25s ease, box-shadow .25s ease;
    }
    input:focus,select:focus,textarea:focus {
      border-color:var(--rosa);
      box-shadow:0 0 0 3px rgba(230,165,182,0.2);
      outline:none;
    }
    textarea{min-height:90px;resize:vertical;}
    .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));}
    .pedido-summary{background:#fff3f6;border:1px solid var(--borde);border-radius:12px;padding:10px 16px;margin-bottom:16px;font-weight:600;color:#a34b6d;}
    .actions{display:flex;justify-content:space-between;margin-top:20px;gap:12px;}
    .btn-primary{background:var(--rosa);color:#fff;border:none;border-radius:10px;padding:12px 22px;font-weight:800;cursor:pointer;}
    .btn-outline{background:#fff;border:2px solid var(--rosa);color:var(--rosa);border-radius:10px;padding:12px 22px;font-weight:700;cursor:pointer;}
    .btn-outline:hover{background:var(--rosa);color:#fff;}
    .firma-box{margin-top:20px;padding:14px 16px;border:1px dashed var(--rosa);border-radius:12px;background:#fff9fa;}

    /* === BOT√ìN FLOTANTE CARRITO === */
    #btnVerCarrito {
      position:fixed;bottom:20px;right:20px;
      background:var(--rosa);color:#fff;
      border:none;border-radius:50%;
      width:56px;height:56px;cursor:pointer;
      font-size:1.4rem;box-shadow:0 6px 14px rgba(0,0,0,0.15);
      z-index:1000;
    }

    /* === PANEL LATERAL MEJORADO === */
    .overlay {
      position:fixed;inset:0;
      background:rgba(0,0,0,.35);
      opacity:0;pointer-events:none;
      transition:opacity .3s ease;
      z-index:998;
    }
    .overlay.active {opacity:1;pointer-events:all;}

    .cart-sidebar {
      position:fixed;top:0;right:-420px;
      width:380px;height:100%;
      background:#fff;
      box-shadow:-6px 0 25px rgba(0,0,0,.15);
      border-left:3px solid #f2d3dc;
      display:flex;flex-direction:column;
      padding:20px;
      transition:right .4s ease;
      z-index:999;
    }
    .cart-sidebar.open {right:0;}
    .cart-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
    .cart-header h3{color:#c97b94;font-weight:700;margin:0;}
    .cart-header button{background:none;border:none;font-size:1.3rem;cursor:pointer;color:#c97b94;}

    .sidebar-items{flex:1;overflow-y:auto;margin-bottom:16px;}
    .sidebar-item{display:flex;align-items:center;border-bottom:1px solid #f2f2f2;padding:10px 0;}
    .sidebar-thumb{width:48px;height:48px;border-radius:8px;object-fit:cover;margin-right:10px;}
    .sidebar-item-info{flex:1;}
    .sidebar-item-name{font-weight:600;color:#444;}
    .sidebar-item-price{color:#777;font-size:.9rem;}
    .qty-control{display:flex;align-items:center;gap:6px;background:#fafafa;border-radius:6px;padding:4px 6px;}
    .qty-btn{background:#e6a5b6;border:none;color:#fff;width:22px;height:22px;border-radius:5px;cursor:pointer;font-weight:bold;line-height:1;}
    .qty-btn:hover{background:#c97b94;}

    .sidebar-summary{
      border-top:2px solid #f2d3dc;
      padding-top:10px;
      background:linear-gradient(180deg,#fff,#fff8fa);
      border-radius:12px;
      box-shadow:0 -2px 10px rgba(0,0,0,.05);
    }
    .sidebar-summary p{margin:6px 0;text-align:right;}
    .sidebar-summary p.total{font-size:1.05rem;color:#c97b94;font-weight:700;}
    .full-btn{
      margin-top:10px;width:100%;
      background:#e6a5b6;color:#fff;
      border:none;border-radius:10px;
      padding:12px;font-weight:700;
      cursor:pointer;transition:background .2s ease;
    }
    .full-btn:hover{background:#c97b94;}
  </style>
</head>

<body>
  <header>
    <img src="img/logo 2024 marca registrada-04.png" alt="Flora Logo">
    <h2>Cat√°logo de Arreglos Florales</h2>
  </header>

  <section id="viewCatalog" class="view active">
    <div id="catalogo" class="catalogo"></div>
  </section>

  <section id="viewForm" class="view">
    <form id="pedidoForm">
      <div class="pedido-summary" id="resumenProducto">üõç Tu pedido</div>

      <h3>Datos del Cliente</h3>
      <div class="grid">
        <div><label>Identificaci√≥n</label><input id="identificacion" name="identificacion" required></div>
        <div><label>Tel√©fono</label><input id="telefono" name="telefono" required></div>
        <div><label>Nombre</label><input id="primerNombre" name="primerNombre" required></div>
      </div>

      <h3>Entrega</h3>
      <div class="grid">
        <div><label>Destinatario</label><input id="destinatario" name="destinatario" required></div>
        <div><label>Barrio</label><select id="barrio" name="barrio"></select></div>
        <div><label>Direcci√≥n</label><input id="direccion" name="direccion" required></div>
      </div>

      <h3>Pago y Mensaje</h3>
      <div class="grid">
        <div><label>Medio de pago</label>
          <select id="formaPago" name="formaPago" required>
            <option value="TRANSFERENCIA">Transferencia</option>
            <option value="EFECTIVO">Efectivo</option>
          </select>
        </div>
        <div><label>Mensaje</label><textarea id="mensaje" name="mensaje"></textarea></div>
      </div>

      <input type="hidden" id="producto" name="producto">
      <input type="hidden" id="precio" name="precio">

      <div class="actions">
        <button type="button" class="btn-outline" id="btnVolver">Regresar</button>
        <button type="submit" class="btn-primary">Confirmar pedido</button>
      </div>
    </form>
  </section>

  <button id="btnVerCarrito">üõí</button>

  <!-- === PANEL LATERAL MEJORADO === -->
  <div id="overlay" class="overlay"></div>
  <div id="cartSidebar" class="cart-sidebar">
    <div class="cart-header">
      <h3>üõçÔ∏è Tu carrito</h3>
      <button id="btnCerrarSidebar">‚úñÔ∏è</button>
    </div>
    <div id="sidebarItems" class="sidebar-items"></div>

    <div class="sidebar-summary">
      <p><strong>Subtotal:</strong> $<span id="sidebarSubtotal">0</span></p>
      <p><strong>Domicilio:</strong> $<span id="sidebarDomicilio">0</span></p>
      <p class="total"><strong>Total:</strong> $<span id="sidebarTotal">0</span></p>
      <button id="btnIrAlPedido" class="full-btn">Proceder al pedido</button>
    </div>
  </div>

  <script>
    const SCRIPT_URL="https://script.google.com/macros/s/AKfycbwol802NzgXkLtWVJiDLX_MnOXlyyWxL0AnVVef1GO8L7TVYAI5uH_6jkJomakcWlih/exec";
    const state={catalogo:[],barrios:{},cart:[],domicilio:0};
    const fmtCOP=v=>Number(v||0).toLocaleString('es-CO');

    async function init(){
      const res=await fetch(SCRIPT_URL);
      const data=await res.json();
      state.catalogo=data.catalogo||[];
      state.barrios=data.barrios||{};
      renderCatalog();fillBarrios();
    }

    function fillBarrios(){
      const sel=document.getElementById("barrio");
      sel.innerHTML='<option value="">Selecciona‚Ä¶</option>';
      Object.keys(state.barrios).forEach(b=>{
        const opt=document.createElement("option");
        opt.value=b;opt.textContent=`${b} ($${fmtCOP(state.barrios[b])})`;
        sel.appendChild(opt);
      });
      sel.addEventListener("change",()=>{
        const val=sel.value;
        state.domicilio=state.barrios[val]||0;
        renderSidebarCart();
        Swal.fire({title:"Domicilio actualizado",text:`$${fmtCOP(state.domicilio)}`,icon:"info",timer:1200,showConfirmButton:false});
      });
    }

    function addToCart(prod){
      const existing=state.cart.find(p=>p.name===prod.name);
      if(existing)existing.qty++; else state.cart.push({...prod,qty:1});
      Swal.fire({title:'Agregado',text:`${prod.name} a√±adido al carrito`,icon:'success',timer:1000,showConfirmButton:false});
      renderSidebarCart();
    }

    function changeQty(name,delta){
      const item=state.cart.find(p=>p.name===name);
      if(!item)return;
      item.qty+=delta;
      if(item.qty<=0)state.cart=state.cart.filter(p=>p.name!==name);
      renderSidebarCart();
    }

    function renderCatalog(){
      const cont=document.getElementById("catalogo");cont.innerHTML="";
      state.catalogo.forEach(prod=>{
        if(!prod.img)return;
        const card=document.createElement("div");
        card.className="card";
        card.innerHTML=`<img src="${prod.img}" alt="${prod.name}">
          <div class="body"><div class="name">${prod.name}</div>
          <div class="price">$${fmtCOP(prod.price)}</div>
          <button class="btn-add">Agregar al carrito</button></div>`;
        card.querySelector(".btn-add").addEventListener("click",()=>addToCart(prod));
        cont.appendChild(card);
      });
    }

    function renderSidebarCart(){
      const cont=document.getElementById("sidebarItems");cont.innerHTML="";
      let subtotal=0;
      if(state.cart.length===0){cont.innerHTML='<p style="text-align:center;color:#777;">Tu carrito est√° vac√≠o üõí</p>';}
      else{
        state.cart.forEach(p=>{
          subtotal+=p.price*p.qty;
          cont.innerHTML+=`
          <div class="sidebar-item">
            <img src="${p.img}" class="sidebar-thumb">
            <div class="sidebar-item-info"><div class="sidebar-item-name">${p.name}</div><div class="sidebar-item-price">$${fmtCOP(p.price)}</div></div>
            <div class="qty-control">
              <button class="qty-btn" onclick="changeQty('${p.name}',-1)">-</button>
              <span>${p.qty}</span>
              <button class="qty-btn" onclick="changeQty('${p.name}',1)">+</button>
            </div>
          </div>`;
        });
      }
      const total=subtotal+state.domicilio;
      document.getElementById("sidebarSubtotal").textContent=fmtCOP(subtotal);
      document.getElementById("sidebarDomicilio").textContent=fmtCOP(state.domicilio);
      document.getElementById("sidebarTotal").textContent=fmtCOP(total);
    }

    function openSidebar(){
      document.getElementById("overlay").classList.add("active");
      document.getElementById("cartSidebar").classList.add("open");
      renderSidebarCart();
    }
    function closeSidebar(){
      document.getElementById("overlay").classList.remove("active");
      document.getElementById("cartSidebar").classList.remove("open");
    }
    document.getElementById("overlay").addEventListener("click",closeSidebar);
    document.getElementById("btnVerCarrito").addEventListener("click",openSidebar);
    document.getElementById("btnCerrarSidebar").addEventListener("click",closeSidebar);
    document.getElementById("btnIrAlPedido").addEventListener("click",()=>{closeSidebar();Swal.fire('Ir al pedido','Completa tus datos para finalizar.','info');});

    init();
  </script>
</body>
</html>
