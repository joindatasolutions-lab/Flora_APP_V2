<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<title>Flora - Tienda de Flores</title>
<style>
  :root{ --rosa:#e6a5b6; --rosa-osc:#c97b94; --bg:#fdfaf7; --gris:#5c5c5c; --borde:#ecd6dc; }
  *{ box-sizing:border-box }
  body{ margin:0; font-family:'Inter', sans-serif; background:var(--bg); color:#333; display:flex; min-height:100vh; flex-direction:column }
  header{ text-align:center; padding:20px 16px }
  header img{ max-width:220px; height:auto; display:block; margin:0 auto 8px }
  header h2{ margin:8px 0 0; color:var(--gris) }
  .view{ display:none; padding:16px; animation:fade .25s ease }
  .view.active{ display:block }
  @keyframes fade{ from{ opacity:.35; transform:translateY(4px) } to{ opacity:1; transform:none } }

  /* Catálogo */
  .catalogo{ 
    display:grid; 
    gap:12px; 
    grid-template-columns:repeat(2,1fr); /* 2 por fila en móviles */
    max-width:1100px; 
    margin:0 auto 
  }
  @media(min-width:768px){
    .catalogo{ grid-template-columns:repeat(3,1fr); }
  }
  @media(min-width:1024px){
    .catalogo{ grid-template-columns:repeat(4,1fr); }
  }
  .card{
    background:#fff; border:1px solid var(--borde); border-radius:18px;
    box-shadow:0 6px 18px rgba(0,0,0,.06);
    overflow:hidden; transition:transform .15s ease, box-shadow .15s ease, border-color .2s; cursor:pointer;
    display:flex; flex-direction:column; align-items:center; padding:10px;
  }
  .card:hover{ transform:translateY(-2px); box-shadow:0 10px 24px rgba(0,0,0,.09); border-color:var(--rosa) }
  .card.selected{ outline:3px solid var(--rosa) }
  .card img{ width:100%; height:120px; object-fit:cover; border-bottom:1px solid var(--borde); filter:saturate(1.02) }
  .card .body{ padding:8px; text-align:center; flex-grow:1 }
  .name{ font-weight:700; margin:6px 0 2px; font-size:.9rem }
  .price{ color:var(--gris); margin:0; font-size:.9rem }
  .btn-add{
    margin-top:6px; padding:6px 10px; font-size:.85rem; border:none; border-radius:8px; cursor:pointer;
    background:var(--rosa); color:#fff; font-weight:600; transition:background .2s ease;
  }
  .btn-add:hover{ background:var(--rosa-osc); }
</style>
</head>
<body>
<header>
  <img src="img/logo 2024 marca registrada-04.png" alt="FLORA Logo"/>
  <h2>Catálogo de Arreglos Florales</h2>
</header>

<!-- VISTA 1: Catálogo -->
<section id="viewCatalog" class="view active">
  <div id="catalogo" class="catalogo"></div>
  <div class="actions">
    <button id="btnContinuar" class="btn" disabled>Continuar</button>
  </div>
</section>

<!-- VISTA 2: Formulario -->
<section id="viewForm" class="view">
  <!-- ... resto del formulario sin cambios ... -->
</section>

<script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwW2TpbWuBO0kpE1wYnz9Eizyeus3KcMwVeO0fgp6EdBFZvo9JYsH0J9IZL_zRGlBQ/exec";

  const state = { selected: null, barrios: {} };
  const fmtCOP = v => Number(v || 0).toLocaleString('es-CO');

  async function init() {
    try {
      const res = await fetch(SCRIPT_URL);
      const { catalogo, barrios } = await res.json();
      state.barrios = barrios || {};
      renderCatalog(catalogo || []);
      fillBarrios(barrios || {});
      const hoy = new Date().toISOString().slice(0,10);
      document.getElementById('fechaEntrega').setAttribute('min', hoy);
    } catch (e) {
      document.getElementById('catalogo').innerHTML = "<p>Error cargando datos. Revisa la URL del WebApp.</p>";
    }
  }

  function renderCatalog(items) {
    const wrap = document.getElementById('catalogo');
    wrap.innerHTML = "";
    items.forEach(prod => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img src="${prod.img}" alt="${prod.name}">
        <div class="body">
          <div class="name">${prod.name}</div>
          <p class="price">$${fmtCOP(prod.price)}</p>
          <button class="btn-add">Añadir</button>
        </div>
      `;
      card.querySelector('.btn-add').addEventListener('click', (ev) => {
        ev.stopPropagation();
        selectProduct(card, prod);
        document.getElementById('btnContinuar').click();
      });
      card.addEventListener('click', () => selectProduct(card, prod));
      wrap.appendChild(card);
    });
  }

  function selectProduct(card, prod) {
    document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
    card.classList.add('selected');
    state.selected = prod;
    document.getElementById('btnContinuar').disabled = false;
  }

  function fillBarrios(dict) {
    const sel = document.getElementById('barrio');
    sel.innerHTML = '<option value="">Selecciona…</option>';
    Object.keys(dict).forEach(nombre => {
      const opt = document.createElement('option');
      opt.value = nombre;
      opt.textContent = nombre;
      sel.appendChild(opt);
    });
  }

  init();
</script>
</body>
</html>
