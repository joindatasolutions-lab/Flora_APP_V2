<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flora - Panel de Domicilios</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --rosa:#e6a5b6;
    --rosa-osc:#c97b94;
    --bg:#fdfaf7;
    --gris:#5c5c5c;
    --borde:#ecd6dc;
    --verde:#1a7f37;
    --amarillo:#a15d00;
  }
  body{ font-family:'Inter',sans-serif; background:var(--bg); margin:0; color:#333; }
  header{ text-align:center; background:#fff; padding:20px; border-bottom:1px solid var(--borde); box-shadow:0 2px 6px rgba(0,0,0,.05); }
  header img{ max-width:200px; margin-bottom:6px; }
  h2{ margin:0; color:var(--gris); }
  .filtros{ text-align:center; margin:16px; }
  select, input[type=text]{
    padding:8px 12px; border:1px solid var(--borde);
    border-radius:8px; font-family:'Inter'; font-size:14px; margin:0 6px;
  }
  .grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:16px; padding:16px; max-width:1200px; margin:auto; }
  .card{ background:white; border:1px solid var(--borde); border-radius:16px; padding:16px;
    box-shadow:0 4px 12px rgba(0,0,0,.05); transition:transform .1s ease; }
  .card:hover{ transform:translateY(-2px); }
  .estado{ font-weight:700; color:var(--rosa-osc); }
  .asignado{ color:var(--gris); font-size:.9rem; margin:4px 0; }
  .btn{ border:none; border-radius:8px; padding:6px 12px; margin:3px; font-weight:600; cursor:pointer; }
  .btn-tomar{ background:var(--rosa); color:#fff; }
  .btn-ruta{ background:#fff2cc; color:var(--amarillo); }
  .btn-entregado{ background:#d7f5dd; color:var(--verde); }
  footer{ text-align:center; font-size:.85rem; color:var(--gris); padding:12px; border-top:1px solid var(--borde); }
</style>
</head>
<body>
  <header>
    <img src="img/logo 2024 marca registrada-04.png" alt="Flora Logo"/>
    <h2>Panel de Domicilios</h2>
  </header>

  <div class="filtros">
    <label>Filtrar por estado:</label>
    <select id="filtroEstado" onchange="filtrar()">
      <option value="">Todos</option>
      <option value="Pendiente">Pendiente</option>
      <option value="En ruta">En ruta</option>
      <option value="Entregado">Entregado</option>
    </select>
    <input type="text" id="buscar" placeholder="Buscar pedido o cliente..." oninput="filtrar()">
  </div>

  <div id="pedidos" class="grid">Cargando pedidos...</div>

  <footer>Â© 2025 Flora - Tienda de Flores ðŸŒ¸</footer>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbygooVDtuPm2mzCYcpAH37pAXXVvQTg8OV86DUz73f4p3g1QJOhCI-u0-VkI6UsNI6jaw/exec"; // ðŸ‘ˆ cambia aquÃ­ tu URL
let pedidosGlobal = [];

async function cargarPedidos(){
  const res = await fetch(`${SCRIPT_URL}?accion=getPedidos`);
  pedidosGlobal = await res.json();
  renderPedidos(pedidosGlobal);
}

function filtrar(){
  const estadoSel = document.getElementById("filtroEstado").value.toLowerCase();
  const buscar = document.getElementById("buscar").value.toLowerCase();
  const filtrados = pedidosGlobal.filter(p => {
    const matchEstado = estadoSel ? (String(p["Estado Domicilio"]||"").toLowerCase()===estadoSel) : true;
    const matchTexto = buscar ? (
      String(p.Cliente||"").toLowerCase().includes(buscar) ||
      String(p["NÂ°Pedido"]||"").toLowerCase().includes(buscar)
    ) : true;
    return matchEstado && matchTexto;
  });
  renderPedidos(filtrados);
}

function renderPedidos(pedidos){
  const cont=document.getElementById("pedidos");
  cont.innerHTML="";
  if(!pedidos.length){
    cont.innerHTML="<p style='text-align:center;color:gray'>No hay pedidos con este filtro</p>";
    return;
  }
  pedidos.forEach(p=>{
    const div=document.createElement("div");
    div.className="card";
    div.innerHTML=`
      <h3>Pedido #${p["NÂ°Pedido"]}</h3>
      <p><b>Cliente:</b> ${p.Cliente||""}</p>
      <p><b>DirecciÃ³n:</b> ${p["DirecciÃ³n de Entrega"]||""}</p>
      <p><b>Barrio:</b> ${p.Barrio||""}</p>
      <p><b>TelÃ©fono:</b> ${p.TelefonoDestino||""}</p>
      <p class="estado">Estado: ${p["Estado Domicilio"]||"Pendiente"}</p>
      <p class="asignado">Domiciliario: ${p.Domiciliario||"Sin asignar"}</p>
      <div>
        <button class="btn btn-tomar" onclick="asignar('${p["NÂ°Pedido"]}')">Tomar</button>
        <button class="btn btn-ruta" onclick="cambiarEstado('${p["NÂ°Pedido"]}','En ruta')">En ruta</button>
        <button class="btn btn-entregado" onclick="cambiarEstado('${p["NÂ°Pedido"]}','Entregado')">Entregado</button>
      </div>`;
    cont.appendChild(div);
  });
}

async function asignar(pedidoId){
  const nombre = prompt("Ingrese su nombre:");
  if(!nombre) return;
  const cambios = {
    "Domiciliario": nombre,
    "Estado Domicilio": "En ruta",
    "FechaAsignaciÃ³n": new Date().toISOString()
  };
  await fetch(`${SCRIPT_URL}?accion=updatePedido&id=${pedidoId}&cambios=${encodeURIComponent(JSON.stringify(cambios))}`);
  cargarPedidos();
}

async function cambiarEstado(pedidoId, estado){
  const cambios = {"Estado Domicilio": estado};
  await fetch(`${SCRIPT_URL}?accion=updatePedido&id=${pedidoId}&cambios=${encodeURIComponent(JSON.stringify(cambios))}`);
  cargarPedidos();
}

cargarPedidos();
</script>
</body>
</html>



